<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Painel de Den√∫ncias Proposta de Projeto</title>
  <link rel="stylesheet" href="/css/pag-adm.css">
  <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:ital,wght@0,100..700;1,100..700&family=Mo‚Ä¶ rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swa‚Ä¶ rel="stylesheet">
  <link href='https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css' rel='stylesheet'>
  <!-- <link rel="stylesheet" href="/css/adm-lista-denuncias-comentarios.css"> -->
   
   <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/simple-notify@0.5.5/dist/simple-notify.min.css" />
   <script src="https://cdn.jsdelivr.net/npm/simple-notify@0.5.5/dist/simple-notify.min.js"></script>
   <script src="/js/simple-notify.js"></script>


  <link rel="stylesheet" href="/css/adm-lista-denuncias-comentario.css">

    <!-- √çcones Lucide -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <!-- √çcones Remix -->
   <link href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/fonts/remixicon.css" rel="stylesheet">


 
 


</head>
<body>
 
   <%  if (dadosNotificacao) { %>
        <script>
                notify("<%= dadosNotificacao.titulo%>","<%= dadosNotificacao.mensagem%>", "<%= dadosNotificacao.tipo%>", "top right");
                                   
        </script>
    <% } %>
      <!--INICIO DO MENU TOP ADM -->
 
    <%- include('../partials/menu_top_adm.ejs'); %>
 
    <!--FIM DO MENU TOP ADM  -->
 
 
    <!-- MENU LATERAL DO ADM -->
 
    <%- include('../partials/menu_lateral_adm.ejs'); %>
 
    <!-- MENU LATERAL DO ADM -->
 
 
    <h1 class="titulo-denuncias">üìã Den√∫ncias de propostas de projeto</h1>
 
 
 
  <section class="container">
    <% if (denuncias.length > 0) { %>
      <% denuncias.forEach(denuncia => { %>
        <section class="card">
          <section class="card-header">
            <h2>Den√∫ncia #<%= denuncia.ID_DENUNCIA %></h2>
            <span class="status <%= denuncia.STATUS %>">
              <%= denuncia.STATUS %>
            </span>
          </section>

   <section class="card-body">
  <p><span class="label">Usu√°rio Denunciante:</span> <%= denuncia.NOME_DENUNCIANTE || 'An√¥nimo' %></p>
  <p><span class="label">Usu√°rio Denunciado:</span> <%= denuncia.NOME_DENUNCIADO || 'Desconhecido' %></p>
  <p><span class="label">Proposta:</span> <%= denuncia.TITULO_PROPOSTA || 'Conte√∫do n√£o dispon√≠vel' %></p>
  <p><span class="label">Motivo:</span> <%= denuncia.MOTIVO || 'Sem motivo informado' %></p>
  <p><span class="label">Data da den√∫ncia:</span> 
    <%= denuncia.DATA_DENUNCIA ? new Date(denuncia.DATA_DENUNCIA).toLocaleString('pt-BR') : 'Data indispon√≠vel' %>
  </p>
</section>



          <section class="card-footer">
            <button class="btn-btn-detalhes" onclick="window.location.href='/propostadeprojeto/<%= denuncia.ID_PROPOSTA %>'">
              <i class="ri-search-2-line"></i> Ver proposta
            </button>

            <!-- Bot√£o que abre o modal -->
            <button 
              class="btn-btn-status" 
              data-id="<%= denuncia.ID_DENUNCIA %>" 
              data-usuario="<%= denuncia.ID_USUARIO_DENUNCIADO %>">
              <i class="ri-edit-2-fill"></i>Status
            </button>
          </section>
        </section>
      <% }) %>
    <% } else { %>
      <p style="text-align: center; font-size: 18px; grid-column: 1 / -1;"> Nenhuma den√∫ncia encontrada</p>
    <% } %>


  <!-- MODAL DE ALTERAR STATUS -->
<section id="modalStatus" class="modal">
  <section class="modal-content">
    <h2>Alterar Status da Den√∫ncia</h2>

    <form id="formStatusProposta" method="POST">
      <input type="hidden" name="idDenuncia" id="idDenunciaProposta">
      <input type="hidden" name="idUsuario" id="idUsuarioProposta">

      <label for="acaoProposta">A√ß√£o:</label>
      <select id="acaoProposta" name="acao">
        <option value="">Selecione...</option>
        <option value="suspender">Suspender Usu√°rio</option>
        <option value="descartar">Descartar Den√∫ncia</option>
      </select>

      <section id="opcoesSuspensaoProposta" style="display:none;">
        <p>O usu√°rio ser√° suspenso imediatamente.</p>
      </section>

      <section class="botoes-modal">
        <button type="submit" class="btn-confirmar">Confirmar</button>
        <button type="button" onclick="fecharModalProposta()" class="btn-cancelar">Cancelar</button>
      </section>
    </form>
  </section>
</section>


  </section>


    <script>
    lucide.createIcons();
  </script>

 <script>
document.addEventListener("DOMContentLoaded", () => {
  const modal = document.getElementById("modalStatus");
  const btnsStatus = document.querySelectorAll(".btn-btn-status"); // üîπ corrigido aqui
  const acao = document.getElementById("acaoProposta");
  const opcoesSuspensao = document.getElementById("opcoesSuspensaoProposta");
  const form = document.getElementById("formStatusProposta");

  // Abrir modal e preencher IDs
  btnsStatus.forEach(btn => {
    btn.addEventListener("click", () => {
      const idDenuncia = btn.getAttribute("data-id");
      const idUsuario = btn.getAttribute("data-usuario");

      document.getElementById("idDenunciaProposta").value = idDenuncia;
      document.getElementById("idUsuarioProposta").value = idUsuario;

      modal.style.display = "block";
      acao.value = "";
      opcoesSuspensao.style.display = "none";
    });
  });

  // Fechar modal
  function fecharModalProposta() {
    modal.style.display = "none";
    acao.value = "";
    opcoesSuspensao.style.display = "none";
  }
  window.fecharModalProposta = fecharModalProposta;
  window.addEventListener("click", e => { if (e.target === modal) fecharModalProposta(); });

  // Mostrar aviso de suspens√£o
  acao.addEventListener("change", () => {
    opcoesSuspensao.style.display = acao.value === "suspender" ? "block" : "none";
  });

  // Mudar a√ß√£o do form dependendo da escolha
  form.addEventListener("submit", e => {
    if (!acao.value) {
      e.preventDefault();
      return alert("Selecione uma a√ß√£o antes de confirmar.");
    }

    const idUsuario = document.getElementById("idUsuarioProposta").value;

    if (acao.value === "suspender") {
      form.action = "/adm/desativar-usuario/" + idUsuario; // rota de suspens√£o
      form.method = "POST"; // ou PUT, dependendo da tua rota
    } else if (acao.value === "descartar") {
      form.action = "/adm/excluir-denuncia-proposta"; // rota pra excluir den√∫ncia
      form.method = "POST";
    }
  });
});
</script>



      <!-- LINK DO MENU LATERAL -->
      <script src="/js/menu-lateral-adm.js"></script>

    <!-- LINK DAS NOTIFICA√á√ïES -->
      <script src="js/simple-notify.js"></script>


</body>
</html>