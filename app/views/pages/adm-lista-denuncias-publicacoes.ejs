<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Painel de Den√∫ncias Publica√ß√µes</title>
  <link rel="stylesheet" href="/css/pag-adm.css">
  <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:ital,wght@0,100..700;1,100..700&family=Mo‚Ä¶ rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swa‚Ä¶ rel="stylesheet">
  <link href='https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css' rel='stylesheet'>
  
   <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/simple-notify@0.5.5/dist/simple-notify.min.css" />
   <script src="https://cdn.jsdelivr.net/npm/simple-notify@0.5.5/dist/simple-notify.min.js"></script>
   <script src="/js/simple-notify.js"></script>

  <!-- <link rel="stylesheet" href="/css/adm-lista-denuncias-comentarios.css"> -->

  <link rel="stylesheet" href="/css/adm-lista-denuncias-comentario.css">

    <!-- √çcones Lucide -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <!-- √çcones Remix -->
   <link href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/fonts/remixicon.css" rel="stylesheet">


 
 


</head>
<body>
 
   <%  if (dadosNotificacao) { %>
        <script>
                notify("<%= dadosNotificacao.titulo%>","<%= dadosNotificacao.mensagem%>", "<%= dadosNotificacao.tipo%>", "top right");
                                   
        </script>
    <% } %>
      <!--INICIO DO MENU TOP ADM -->
 
    <%- include('../partials/menu_top_adm.ejs'); %>
 
    <!--FIM DO MENU TOP ADM  -->
 
 
    <!-- MENU LATERAL DO ADM -->
 
    <%- include('../partials/menu_lateral_adm.ejs'); %>
 
    <!-- MENU LATERAL DO ADM -->
 
 
    <h1 class="titulo-denuncias">üìã Den√∫ncias de publica√ß√µes</h1>
 
  <section class="container">
    
    <% if (denuncias.length > 0) { %>
      <% denuncias.forEach(denuncia => { %>
        <section class="card">
          <section class="card-header">
            <h2>Den√∫ncia #<%= denuncia.ID_DENUNCIA %></h2>
            <span class="status <%= denuncia.STATUS %>">
              <%= denuncia.STATUS %>
            </span>
          </section>

     <section class="card-body">
  <p><span class="label">Usu√°rio Denunciante:</span> <%= denuncia.NOME_DENUNCIANTE || 'An√¥nimo' %></p>
  <p><span class="label">Usu√°rio Denunciado:</span> <%= denuncia.NOME_DENUNCIADO || 'Desconhecido' %></p>
  <p><span class="label">Publica√ß√£o:</span> <%= denuncia.NOME_PUBLICACAO || 'Conte√∫do n√£o dispon√≠vel' %></p>
  <p><span class="label">Motivo:</span> <%= denuncia.MOTIVO %></p>
  <p><span class="label">Data da den√∫ncia:</span> 
    <%= new Date(denuncia.DATA_DENUNCIA).toLocaleString('pt-BR') %>
  </p>
</section>


          <section class="card-footer">
            <button class="btn-btn-detalhes" onclick="window.location.href='/publicacao/<%= denuncia.ID_PUBLICACAO %>'">
              <i class="ri-search-2-line"></i> Detalhes
            </button>

            <!-- Bot√£o que abre o modal -->
            <button 
              class="btn-btn-status" 
              data-id="<%= denuncia.ID_DENUNCIA %>" 
              data-usuario="<%= denuncia.ID_USUARIO_DENUNCIADO %>">
              <i class="ri-edit-2-fill"></i>Status
            </button>
          </section>
        </section>
      <% }) %>
    <% } else { %>
      <p style="text-align: center; font-size: 18px; grid-column: 1 / -1;"> Nenhuma den√∫ncia encontrada</p>
    <% } %>

<!-- MODAL DE ALTERAR STATUS -->
<section id="modalStatus" class="modal">
  <section class="modal-content">
    <h2>Alterar Status da Den√∫ncia</h2>

    <form id="formStatusPublicacao" method="POST">
      <input type="hidden" name="idDenuncia" id="idDenunciaPublicacao">
      <input type="hidden" name="idUsuario" id="idUsuarioPublicacao">

      <label for="acaoPublicacao">A√ß√£o:</label>
      <select id="acaoPublicacao" name="acao">
        <option value="">Selecione...</option>
        <option value="suspender">Suspender Usu√°rio</option>
        <option value="descartar">Descartar Den√∫ncia</option>
      </select>

      <section id="opcoesSuspensaoPublicacao" style="display:none;">
        <p>O usu√°rio ser√° suspenso.</p>
      </section>

      <section class="botoes-modal">
        <button type="submit" class="btn-confirmar">Confirmar</button>
        <button type="button" onclick="fecharModalPublicacao()" class="btn-cancelar">Cancelar</button>
      </section>
    </form>
  </section>
</section>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const modal = document.getElementById("modalStatus");
  const btnsStatus = document.querySelectorAll(".btn-btn-status");
  const acao = document.getElementById("acaoPublicacao");
  const opcoesSuspensao = document.getElementById("opcoesSuspensaoPublicacao");
  const form = document.getElementById("formStatusPublicacao");

  // Abrir modal e preencher IDs
  btnsStatus.forEach(btn => {
    btn.addEventListener("click", () => {
      const idDenuncia = btn.getAttribute("data-id");
      const idUsuario = btn.getAttribute("data-usuario");

      document.getElementById("idDenunciaPublicacao").value = idDenuncia;
      document.getElementById("idUsuarioPublicacao").value = idUsuario;

      modal.style.display = "block";
      acao.value = "";
      opcoesSuspensao.style.display = "none";
    });
  });

  // Fechar modal
  function fecharModalPublicacao() {
    modal.style.display = "none";
    acao.value = "";
    opcoesSuspensao.style.display = "none";
  }
  window.fecharModalPublicacao = fecharModalPublicacao;
  window.addEventListener("click", e => { if (e.target === modal) fecharModalPublicacao(); });

  // Mostrar aviso de suspens√£o
  acao.addEventListener("change", () => {
    opcoesSuspensao.style.display = acao.value === "suspender" ? "block" : "none";
  });

  // Mudar a√ß√£o do form dependendo da op√ß√£o
  form.addEventListener("submit", e => {
    if (!acao.value) {
      e.preventDefault();
      return alert("Selecione uma a√ß√£o antes de confirmar.");
    }

    const idUsuario = document.getElementById("idUsuarioPublicacao").value;

    if (acao.value === "suspender") {
      form.action = "/adm/desativar-usuario/" + idUsuario;
      form.method = "POST";
    } else if (acao.value === "descartar") {
      form.action = "/adm/excluir-denuncia-publicacao";
      form.method = "POST";
    }
  });
});
</script>


      <!-- LINK DO MENU LATERAL -->
      <script src="/js/menu-lateral-adm.js"></script>

    <!-- LINK DAS NOTIFICA√á√ïES -->
      <script src="js/simple-notify.js"></script>


</body>
</html>